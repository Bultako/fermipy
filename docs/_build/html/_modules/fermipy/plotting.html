

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fermipy.plotting &mdash; Fermipy 0.18.0+17.gdd46b.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Fermipy
          

          
          </a>

          
            
            
              <div class="version">
                0.18.0+17.gdd46b.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../output.html">Output File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fitting.html">ROI Optimization and Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model.html">Customizing the Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer.html">Developer Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/index.html">Advanced Analysis Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../validation/index.html">Validation Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fermipy.html">fermipy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fermipy_jobs.html">fermipy.jobs subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fermipy_diffuse.html">fermipy.diffuse subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Fermipy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../fermipy.html">fermipy</a> &raquo;</li>
        
      <li>fermipy.plotting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fermipy.plotting</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">PathEffects</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">,</span> <span class="n">PowerNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="k">import</span> <span class="n">Line2D</span>
<span class="kn">import</span> <span class="nn">matplotlib.mlab</span> <span class="k">as</span> <span class="nn">mlab</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="k">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">SkyCoord</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="k">import</span> <span class="n">WcsNDMap</span><span class="p">,</span> <span class="n">HpxNDMap</span><span class="p">,</span> <span class="n">MapCoord</span>

<span class="kn">import</span> <span class="nn">fermipy</span>
<span class="kn">import</span> <span class="nn">fermipy.config</span>
<span class="kn">import</span> <span class="nn">fermipy.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">fermipy.wcs_utils</span> <span class="k">as</span> <span class="nn">wcs_utils</span>
<span class="kn">import</span> <span class="nn">fermipy.hpx_utils</span> <span class="k">as</span> <span class="nn">hpx_utils</span>
<span class="kn">import</span> <span class="nn">fermipy.defaults</span> <span class="k">as</span> <span class="nn">defaults</span>
<span class="kn">import</span> <span class="nn">fermipy.catalog</span> <span class="k">as</span> <span class="nn">catalog</span>
<span class="kn">from</span> <span class="nn">fermipy.utils</span> <span class="k">import</span> <span class="n">merge_dict</span>
<span class="kn">from</span> <span class="nn">fermipy.logger</span> <span class="k">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">fermipy.logger</span> <span class="k">import</span> <span class="n">log_level</span>


<div class="viewcode-block" id="truncate_colormap"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.truncate_colormap">[docs]</a><span class="k">def</span> <span class="nf">truncate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that extracts a subset of a colormap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">minval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minval</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">maxval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-trunc-</span><span class="si">%.2g</span><span class="s2">-</span><span class="si">%.2g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span></div>


<div class="viewcode-block" id="get_xerr"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.get_xerr">[docs]</a><span class="k">def</span> <span class="nf">get_xerr</span><span class="p">(</span><span class="n">sed</span><span class="p">):</span>
    <span class="n">delo</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">]</span>
    <span class="n">dehi</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span>
    <span class="n">xerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">,</span> <span class="n">dehi</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">xerr</span></div>


<div class="viewcode-block" id="make_counts_spectrum_plot"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.make_counts_spectrum_plot">[docs]</a><span class="k">def</span> <span class="nf">make_counts_spectrum_plot</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">imfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span>
    <span class="n">weighted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weighted&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax0</span><span class="p">)</span>

    <span class="c1">#    axes = axes_grid.Grid(fig,111,</span>
    <span class="c1">#                          nrows_ncols=(2,1),</span>
    <span class="c1">#                          axes_pad=0.05,</span>
    <span class="c1">#                          add_all=True)</span>
    <span class="c1">#    ax = axes[0]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">energies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">xerr</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">count_str</span> <span class="o">=</span> <span class="s1">&#39;counts&#39;</span>
    <span class="n">model_counts_str</span> <span class="o">=</span> <span class="s1">&#39;model_counts&#39;</span>
    <span class="n">npred_str</span> <span class="o">=</span> <span class="s1">&#39;npred&#39;</span>

    <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
        <span class="n">count_str</span> <span class="o">+=</span> <span class="s1">&#39;_wt&#39;</span>
        <span class="n">model_counts_str</span> <span class="o">+=</span> <span class="s1">&#39;_wt&#39;</span>
        <span class="n">npred_str</span> <span class="o">+=</span> <span class="s1">&#39;_wt&#39;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">count_str</span><span class="p">]</span>
    <span class="n">ym</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">model_counts_str</span><span class="p">]</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="n">npred_str</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">6</span><span class="p">]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">model_counts_str</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="n">npred_str</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">6</span><span class="p">:]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">model_counts_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;__nolabel__&#39;</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">ym</span><span class="p">)</span> <span class="o">/</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">ym</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy [log$_</span><span class="si">{10}</span><span class="s1">$(E/MeV)]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fractional Residual&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imfile</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_ds9_cmap"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.load_ds9_cmap">[docs]</a><span class="k">def</span> <span class="nf">load_ds9_cmap</span><span class="p">():</span>
    <span class="c1"># http://tdc-www.harvard.edu/software/saoimage/saoimage.color.html</span>
    <span class="n">ds9_b</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span>
        <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span>
        <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
    <span class="p">}</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">register_cmap</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ds9_b&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ds9_b</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ds9_b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;ds9_b&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ds9_b</span></div>


<div class="viewcode-block" id="load_bluered_cmap"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.load_bluered_cmap">[docs]</a><span class="k">def</span> <span class="nf">load_bluered_cmap</span><span class="p">():</span>
    <span class="n">bluered</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                       <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span>

               <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

               <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                        <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                        <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
               <span class="p">}</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">register_cmap</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bluered&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">bluered</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bluered</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;bluered&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bluered</span></div>


<div class="viewcode-block" id="annotate_name"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.annotate_name">[docs]</a><span class="k">def</span> <span class="nf">annotate_name</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="annotate"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.annotate">[docs]</a><span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">loge_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loge_bounds&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">src</span><span class="p">:</span>

        <span class="k">if</span> <span class="s1">&#39;ASSOC1&#39;</span> <span class="ow">in</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;assoc&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;assoc&#39;</span><span class="p">][</span><span class="s1">&#39;ASSOC1&#39;</span><span class="p">]:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;assoc&#39;</span><span class="p">][</span><span class="s1">&#39;ASSOC1&#39;</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="p">[</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">loge_bounds</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;E = </span><span class="si">%.3f</span><span class="s1"> - </span><span class="si">%.3f</span><span class="s1"> GeV&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">loge_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1E3</span><span class="p">,</span>
                                          <span class="mi">10</span> <span class="o">**</span> <span class="n">loge_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1E3</span><span class="p">)]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_markers"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.plot_markers">[docs]</a><span class="k">def</span> <span class="nf">plot_markers</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">transform</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="s1">&#39;icrs&#39;</span><span class="p">)</span>
    <span class="n">path_effects</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path_effects&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span>
                       <span class="n">marker</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">),</span>
                       <span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),</span>
                       <span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;__nolabel__&#39;</span><span class="p">),</span>
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                       <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">path_effects</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="n">path_effects</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_error_ellipse"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.plot_error_ellipse">[docs]</a><span class="k">def</span> <span class="nf">plot_error_ellipse</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">colname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colname&#39;</span><span class="p">,</span> <span class="s1">&#39;r68&#39;</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;pos_err&#39;</span><span class="p">]</span>
    <span class="n">sigmax</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;pos_err_semimajor&#39;</span><span class="p">]</span>
    <span class="n">sigmay</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;pos_err_semiminor&#39;</span><span class="p">]</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;pos_angle&#39;</span><span class="p">]</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
                 <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigmax</span> <span class="o">/</span> <span class="n">cdelt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">,</span>
                 <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigmay</span> <span class="o">/</span> <span class="n">cdelt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">,</span>
                 <span class="n">angle</span><span class="o">=-</span><span class="n">theta</span><span class="p">,</span>
                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImagePlotter"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ImagePlotter">[docs]</a><span class="k">class</span> <span class="nc">ImagePlotter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">WcsNDMap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span> <span class="o">=</span> <span class="s1">&#39;WCS&#39;</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">geom</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">HpxNDMap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span> <span class="o">=</span> <span class="s1">&#39;HPX&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot map of unknown type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">proj</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="n">img</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span>

<div class="viewcode-block" id="ImagePlotter.plot"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ImagePlotter.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">kwargs_contour</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>

        <span class="n">kwargs_imshow</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="n">zscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zscale&#39;</span><span class="p">,</span> <span class="s1">&#39;lin&#39;</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">zscale</span> <span class="o">==</span> <span class="s1">&#39;pow&#39;</span><span class="p">:</span>
            <span class="n">kwargs_imshow</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PowerNorm</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zscale</span> <span class="o">==</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
            <span class="n">kwargs_imshow</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PowerNorm</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">kwargs_imshow</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogNorm</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">zscale</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>
            <span class="n">kwargs_imshow</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs_imshow</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">subplot</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="n">load_ds9_cmap</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;ds9_b&#39;</span><span class="p">)</span>

        <span class="n">colormap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">colormap</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transform</span> <span class="o">==</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">kwargs_imshow</span> <span class="o">=</span> <span class="n">merge_dict</span><span class="p">(</span><span class="n">kwargs_imshow</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs_contour</span> <span class="o">=</span> <span class="n">merge_dict</span><span class="p">(</span><span class="n">kwargs_contour</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_imshow</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs_contour</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_contour</span><span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">cs</span><span class="o">.</span><span class="n">levels</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">coordsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span><span class="o">.</span><span class="n">coordsys</span>
        <span class="k">if</span> <span class="n">coordsys</span> <span class="o">==</span> <span class="s1">&#39;CEL&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;DEC&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">coordsys</span> <span class="o">==</span> <span class="s1">&#39;GAL&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;GLON&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;GLAT&#39;</span><span class="p">)</span>

        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># plt.colorbar(im,orientation=&#39;horizontal&#39;,shrink=0.7,pad=0.15,</span>
        <span class="c1">#                     fraction=0.05)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># , alpha=0.5)</span>
        <span class="c1">#       ax.locator_params(axis=&quot;x&quot;, nbins=12)</span>

        <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="make_cube_slice"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.make_cube_slice">[docs]</a><span class="k">def</span> <span class="nf">make_cube_slice</span><span class="p">(</span><span class="n">map_in</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract a slice from a map cube object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># FIXME: This functionality should be moved into a slice method of</span>
    <span class="c1"># gammapy.maps</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i0</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_axis</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">))</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">map_in</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">to_image</span><span class="p">()</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">to_cube</span><span class="p">([</span><span class="n">new_axis</span><span class="p">])</span>
    <span class="n">map_out</span> <span class="o">=</span> <span class="n">WcsNDMap</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">map_in</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">map_out</span></div>


<div class="viewcode-block" id="ROIPlotter"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter">[docs]</a><span class="k">class</span> <span class="nc">ROIPlotter</span><span class="p">(</span><span class="n">fermipy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Configurable</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;loge_bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>
        <span class="s1">&#39;catalogs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>
        <span class="s1">&#39;graticule_radii&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>
        <span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ds9_b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_map</span><span class="p">,</span> <span class="n">hpx2wcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;roi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ROIPlotter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catalogs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">isstr</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">catalog</span><span class="o">.</span><span class="n">Catalog</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;loge_bounds&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_map</span><span class="p">,</span> <span class="n">WcsNDMap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span> <span class="o">=</span> <span class="s1">&#39;WCS&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_map</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_map</span><span class="p">,</span> <span class="n">HpxNDMap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span> <span class="o">=</span> <span class="s1">&#39;HPX&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span> <span class="o">=</span> <span class="n">data_map</span><span class="o">.</span><span class="n">to_wcs</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hpx2wcs</span><span class="o">=</span><span class="n">hpx2wcs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t make ROIPlotter of unknown projection type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_map</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span> <span class="o">=</span> <span class="n">make_cube_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_implot</span> <span class="o">=</span> <span class="n">ImagePlotter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="o">.</span><span class="n">sum_over_axes</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="o">.</span><span class="n">geom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj</span>

<div class="viewcode-block" id="ROIPlotter.create_from_fits"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.create_from_fits">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_from_fits</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fitsfile</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">map_in</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fitsfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">map_in</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.plot_projection"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.plot_projection">[docs]</a>    <span class="k">def</span> <span class="nf">plot_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iaxis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">data_map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="p">)</span>
        <span class="n">noerror</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;noerror&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">wcs_utils</span><span class="o">.</span><span class="n">wcs_to_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_data_map</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">edge_to_center</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">])</span>
        <span class="n">xerr</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">utils</span><span class="o">.</span><span class="n">edge_to_width</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">])</span>

        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_projection</span><span class="p">(</span><span class="n">data_map</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">iaxis</span><span class="p">,</span>
                                     <span class="n">loge_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">,</span>
                                     <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">noerror</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.get_data_projection"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.get_data_projection">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_data_projection</span><span class="p">(</span><span class="n">data_map</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">iaxis</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">s0</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">iaxis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i0</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">],</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">],</span> <span class="n">xmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span>
            <span class="n">saxes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i0</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">],</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">iaxis</span><span class="p">],</span> <span class="n">xmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span>
            <span class="n">saxes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">loge_bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j0</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span>
                <span class="n">data_map</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val_to_edge</span><span class="p">(</span>
                <span class="n">data_map</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_over_axes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">data_map</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">saxes</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="ROIPlotter.setup_projection_axis"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.setup_projection_axis">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">setup_projection_axis</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iaxis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;LON Offset [deg]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;LAT Offset [deg]&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.plot_sources"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.plot_sources">[docs]</a>    <span class="k">def</span> <span class="nf">plot_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skydir</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span>
                     <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">text_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">nolabels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nolabels&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">label_mask</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_mask&#39;</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nolabels</span><span class="p">:</span>
            <span class="n">label_mask</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">pixcrd</span> <span class="o">=</span> <span class="n">wcs_utils</span><span class="o">.</span><span class="n">skydir_to_pix</span><span class="p">(</span><span class="n">skydir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_implot</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">path_effect</span> <span class="o">=</span> <span class="n">PathEffects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                             <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">show_label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pixcrd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pixcrd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                          <span class="n">labels</span><span class="p">,</span> <span class="n">label_mask</span><span class="p">)):</span>

            <span class="k">if</span> <span class="n">show_label</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span></div>

<div class="viewcode-block" id="ROIPlotter.plot_roi"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.plot_roi">[docs]</a>    <span class="k">def</span> <span class="nf">plot_roi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">src_color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>

        <span class="n">label_ts_threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                           <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                           <span class="c1">#                           markersize=8,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">src_color</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">text_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">src_color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">roi</span><span class="o">.</span><span class="n">point_sources</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">label_ts_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">label_ts_threshold</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="n">label_ts_threshold</span>

        <span class="n">skydir</span> <span class="o">=</span> <span class="n">roi</span><span class="o">.</span><span class="n">_src_skydir</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">roi</span><span class="o">.</span><span class="n">point_sources</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_sources</span><span class="p">(</span><span class="n">skydir</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">text_kwargs</span><span class="p">,</span>
                          <span class="n">label_mask</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.plot_catalog"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.plot_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">plot_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalog</span><span class="p">):</span>

        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lime&#39;</span>

        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                           <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">text_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>

        <span class="n">skydir</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">skydir</span>

        <span class="k">if</span> <span class="s1">&#39;NickName&#39;</span> <span class="ow">in</span> <span class="n">catalog</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;NickName&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Source_Name&#39;</span><span class="p">]</span>

        <span class="n">separation</span> <span class="o">=</span> <span class="n">skydir</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">skydir</span><span class="p">)</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">separation</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_sources</span><span class="p">(</span><span class="n">skydir</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">text_kwargs</span><span class="p">,</span>
                          <span class="n">nolabels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.plot"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">zoom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">graticule_radii</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">])</span>
        <span class="n">label_ts_threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">])</span>

        <span class="n">im_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>
                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">zscale</span><span class="o">=</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>

        <span class="n">cb_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                         <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cb_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">im_kwargs</span> <span class="o">=</span> <span class="n">merge_dict</span><span class="p">(</span><span class="n">im_kwargs</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cb_kwargs</span> <span class="o">=</span> <span class="n">merge_dict</span><span class="p">(</span><span class="n">cb_kwargs</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">im</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_implot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">im_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_catalog</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_roi</span><span class="p">,</span>
                          <span class="n">label_ts_threshold</span><span class="o">=</span><span class="n">label_ts_threshold</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">zoom</span><span class="p">)</span>

        <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_label&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="o">**</span><span class="n">cb_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cb_label</span><span class="p">:</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cb_label</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">graticule_radii</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.draw_circle"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.draw_circle">[docs]</a>    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># coordsys = wcs_utils.get_coordsys(self.proj)</span>
        <span class="n">skydir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skydir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">path_effects</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path_effects&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">skydir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">center_pix</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pix</span> <span class="o">=</span> <span class="n">skydir</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                  <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;__nolabel__&#39;</span><span class="p">)</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">merge_dict</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">pix_radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">pix</span><span class="p">,</span> <span class="n">pix_radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path_effects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="n">path_effects</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIPlotter.zoom"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ROIPlotter.zoom">[docs]</a>    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span>

        <span class="n">xw</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">yw</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">xw</span> <span class="o">/</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">xw</span> <span class="o">/</span> <span class="n">zoom</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">yw</span> <span class="o">/</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">yw</span> <span class="o">/</span> <span class="n">zoom</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="SEDPlotter"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter">[docs]</a><span class="k">class</span> <span class="nc">SEDPlotter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sed</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sed</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sed</span>

<div class="viewcode-block" id="SEDPlotter.get_ylims"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.get_ylims">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_ylims</span><span class="p">(</span><span class="n">sed</span><span class="p">):</span>

        <span class="n">fmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_ul95&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_ul95&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">fdelta</span> <span class="o">=</span> <span class="n">fmax</span> <span class="o">-</span> <span class="n">fmin</span>
        <span class="k">if</span> <span class="n">fdelta</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">fmin</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">fdelta</span><span class="p">)</span>
            <span class="n">fmax</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">fdelta</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span></div>

<div class="viewcode-block" id="SEDPlotter.plot_lnlscan"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot_lnlscan">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_lnlscan</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
        <span class="n">llhcut</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;llhcut&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.70</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;BuGn&#39;</span><span class="p">)</span>
        <span class="n">cmap_trunc_lo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap_trunc_lo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cmap_trunc_hi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap_trunc_hi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">ylim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="o">=</span> <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">get_ylims</span><span class="p">(</span><span class="n">sed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="n">fluxM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">fbins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluxM</span><span class="p">)</span>
        <span class="n">llhMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]),</span> <span class="n">fbins</span><span class="p">))</span>

        <span class="c1"># loop over energy bins</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">])):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;norm_scan&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">e2dnde_scan</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;norm_scan&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;ref_e2dnde&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">e2dnde_scan</span><span class="p">)</span>
            <span class="n">logl</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;dloglike_scan&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
            <span class="n">logl</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">logl</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">logl</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                <span class="n">logli</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">fluxM</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logli</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">fluxM</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">logl</span><span class="p">)</span>
            <span class="n">llhMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">logli</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
        <span class="c1"># cmap.set_under(&#39;w&#39;)</span>

        <span class="k">if</span> <span class="n">cmap_trunc_lo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cmap_trunc_hi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">cmap_trunc_lo</span><span class="p">,</span> <span class="n">cmap_trunc_hi</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>

        <span class="n">xedge</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;loge_max&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;loge_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">yedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">fbins</span><span class="p">)</span>
        <span class="n">xedge</span><span class="p">,</span> <span class="n">yedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xedge</span><span class="p">,</span> <span class="n">yedge</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedge</span><span class="p">,</span> <span class="n">yedge</span><span class="p">,</span> <span class="n">llhMatrix</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">llhcut</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Delta LogLikelihood&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">fmin</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">fmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEDPlotter.plot_flux_points"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot_flux_points">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_flux_points</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

        <span class="n">ul_ts_threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ul_ts_threshold&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="o">=</span> <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">get_ylims</span><span class="p">(</span><span class="n">sed</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ul_ts_threshold</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde&#39;</span><span class="p">]</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_err&#39;</span><span class="p">]</span>
        <span class="n">yerr_lo</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_err_lo&#39;</span><span class="p">]</span>
        <span class="n">yerr_hi</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_err_hi&#39;</span><span class="p">]</span>
        <span class="n">yul</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_ul95&#39;</span><span class="p">]</span>

        <span class="n">delo</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">]</span>
        <span class="n">dehi</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span>
        <span class="n">xerr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">dehi</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
        <span class="n">xerr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">dehi</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">]))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr1</span><span class="p">,</span>
                     <span class="n">yerr</span><span class="o">=</span><span class="p">(</span><span class="n">yerr_lo</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">yerr_hi</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">]),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">yul</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr0</span><span class="p">,</span>
                     <span class="n">yerr</span><span class="o">=</span><span class="n">yul</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">uplims</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">fmin</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">fmax</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDPlotter.plot_resid"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot_resid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_resid</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">model_flux</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

        <span class="n">sed</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;sed&#39;</span><span class="p">]</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">4</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde&#39;</span><span class="p">]</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_err&#39;</span><span class="p">]</span>
        <span class="n">yul</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e2dnde_ul95&#39;</span><span class="p">]</span>
        <span class="n">delo</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">]</span>
        <span class="n">dehi</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">]</span>
        <span class="n">xerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">,</span> <span class="n">dehi</span><span class="p">))</span>

        <span class="n">ym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;e_ctr&#39;</span><span class="p">],</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">],</span>
                       <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">])</span> <span class="o">*</span>
                       <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde&#39;</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">ym</span><span class="p">)</span> <span class="o">/</span> <span class="n">ym</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span> <span class="o">/</span> <span class="n">ym</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDPlotter.plot_model"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">model_flux</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">noband</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;noband&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">e2</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">],</span>
                <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">],</span>
                <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde_lo&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">],</span>
                <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde_hi&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">noband</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;log_energies&#39;</span><span class="p">],</span>
                            <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde_lo&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span>
                            <span class="n">model_flux</span><span class="p">[</span><span class="s1">&#39;dnde_hi&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDPlotter.plot_sed"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot_sed">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_sed</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="n">showlnl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Render a plot of a spectral energy distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        showlnl : bool        </span>
<span class="sd">            Overlay a map of the delta-loglikelihood values vs. flux</span>
<span class="sd">            in each energy bin.</span>

<span class="sd">        cmap : str        </span>
<span class="sd">            Colormap that will be used for the delta-loglikelihood</span>
<span class="sd">            map.</span>

<span class="sd">        llhcut : float</span>
<span class="sd">            Minimum delta-loglikelihood value.</span>

<span class="sd">        ul_ts_threshold : float        </span>
<span class="sd">            TS threshold that determines whether the MLE or UL</span>
<span class="sd">            is plotted in each energy bin.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;BuGn&#39;</span><span class="p">)</span>

        <span class="n">annotate_name</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">plot_flux_points</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">9.</span><span class="p">):</span>

            <span class="k">if</span> <span class="s1">&#39;model_flux&#39;</span> <span class="ow">in</span> <span class="n">sed</span><span class="p">:</span>
                <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">sed</span><span class="p">[</span><span class="s1">&#39;model_flux&#39;</span><span class="p">],</span>
                                      <span class="n">noband</span><span class="o">=</span><span class="n">showlnl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">showlnl</span><span class="p">:</span>
            <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">plot_lnlscan</span><span class="p">(</span><span class="n">sed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy [MeV]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;E$^</span><span class="si">{2}</span><span class="s1">$dN/dE [MeV cm$^{-2}$ s$^{-1}$]&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDPlotter.plot"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.SEDPlotter.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showlnl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SEDPlotter</span><span class="o">.</span><span class="n">plot_sed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sed</span><span class="p">,</span> <span class="n">showlnl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ExtensionPlotter"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ExtensionPlotter">[docs]</a><span class="k">class</span> <span class="nc">ExtensionPlotter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file0</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                   <span class="s1">&#39;mcube_</span><span class="si">%s</span><span class="s1">_noext</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                   <span class="s1">&#39;mcube_</span><span class="si">%s</span><span class="s1">_ext_bkg</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;ccube</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="n">suffix</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;mcube_</span><span class="si">%s</span><span class="s1">_ext</span><span class="si">%02i%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span> <span class="o">=</span> <span class="n">roi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span> <span class="o">=</span> <span class="n">loge_bounds</span>

<div class="viewcode-block" id="ExtensionPlotter.plot"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.ExtensionPlotter.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iaxis</span><span class="p">):</span>

        <span class="n">p0</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">create_from_fits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file2</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_roi</span><span class="p">,</span>
                                         <span class="n">loge_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">create_from_fits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file1</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_roi</span><span class="p">,</span>
                                         <span class="n">loge_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">noerror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Background&#39;</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">))</span>

        <span class="n">fw</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">)[::</span><span class="n">step</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fw</span><span class="p">):</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="n">cf</span> <span class="o">*</span> <span class="mf">0.8</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">create_from_fits</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_roi</span><span class="p">,</span>
                                            <span class="n">loge_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loge_bounds</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">p1</span><span class="o">.</span><span class="n">data</span>
            <span class="n">p</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span>
                              <span class="n">noerror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">$^\circ$&#39;</span> <span class="o">%</span> <span class="n">w</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AnalysisPlotter"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter">[docs]</a><span class="k">class</span> <span class="nc">AnalysisPlotter</span><span class="p">(</span><span class="n">fermipy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Configurable</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="n">fileio</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">fileio</span><span class="p">,</span>
                    <span class="n">logging</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">logging</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fermipy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Configurable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;interactive&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catalogs&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">catalog</span><span class="o">.</span><span class="n">Catalog</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>

<div class="viewcode-block" id="AnalysisPlotter.run"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gta</span><span class="p">,</span> <span class="n">mcube_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make all plots.&quot;&quot;&quot;</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>

        <span class="n">loge_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;loge_bounds&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">loge_bounds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_roi_plots</span><span class="p">(</span><span class="n">gta</span><span class="p">,</span> <span class="n">mcube_map</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">imfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;counts_spectrum&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                       <span class="n">extension</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

        <span class="n">make_counts_spectrum_plot</span><span class="p">(</span><span class="n">gta</span><span class="o">.</span><span class="n">_roi_data</span><span class="p">,</span> <span class="n">gta</span><span class="o">.</span><span class="n">roi</span><span class="p">,</span>
                                  <span class="n">gta</span><span class="o">.</span><span class="n">log_energies</span><span class="p">,</span>
                                  <span class="n">imfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_residmap_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_residmap_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_residmap_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maps</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make plots from the output of</span>
<span class="sd">        `~fermipy.gtanalysis.GTAnalysis.residmap`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maps : dict</span>
<span class="sd">            Output dictionary of</span>
<span class="sd">            `~fermipy.gtanalysis.GTAnalysis.residmap`.</span>

<span class="sd">        roi : `~fermipy.roi_model.ROIModel`</span>
<span class="sd">            ROI Model object.  Generate markers at the positions of</span>
<span class="sd">            the sources in this ROI.</span>

<span class="sd">        zoom : float</span>
<span class="sd">            Crop the image by this factor.  If None then no crop is</span>
<span class="sd">            applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">workdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;workdir&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">])</span>
        <span class="n">use_weights</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;use_weights&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># FIXME, how to set this:</span>
        <span class="n">no_contour</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">])</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">cmap_resid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap_resid&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap_resid&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;catalogs&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catalogs&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">no_contour</span><span class="p">:</span>
            <span class="n">sigma_levels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigma_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>

        <span class="n">load_bluered_cmap</span><span class="p">()</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">use_weights</span><span class="p">:</span>
            <span class="n">sigma_hist_data</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="nb">bool</span><span class="p">)]</span>
            <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;excess&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigma_hist_data</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">sigma_levels</span><span class="p">,</span>
               <span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Significance [$\sigma$]&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_resid</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;residmap_sigma&#39;</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># make and draw histogram</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">nBins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sigma_hist_data</span><span class="p">)</span>
        <span class="c1"># find best fit parameters</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="c1"># make and draw the histogram</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mf">6.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.0</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.0</span>

        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">nBins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
                                   <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="c1"># make and draw best fit line</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># labels and such</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Significance ($\sigma$)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
        <span class="n">paramtext</span> <span class="o">=</span> <span class="s1">&#39;Gaussian fit:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">paramtext</span> <span class="o">+=</span> <span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">mu=</span><span class="si">%.2f</span><span class="s1">$</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mu</span>
        <span class="n">paramtext</span> <span class="o">+=</span> <span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">sigma=</span><span class="si">%.2f</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">paramtext</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;residmap_sigma_hist&#39;</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;residmap_data&#39;</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;residmap_model&#39;</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;excess&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_resid</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;residmap_excess&#39;</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_tsmap_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_tsmap_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_tsmap_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maps</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make plots from the output of</span>
<span class="sd">        `~fermipy.gtanalysis.GTAnalysis.tsmap` or</span>
<span class="sd">        `~fermipy.gtanalysis.GTAnalysis.tscube`.  This method</span>
<span class="sd">        generates a 2D sky map for the best-fit test source in</span>
<span class="sd">        sqrt(TS) and Npred.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maps : dict</span>
<span class="sd">            Output dictionary of</span>
<span class="sd">            `~fermipy.gtanalysis.GTAnalysis.tsmap` or</span>
<span class="sd">            `~fermipy.gtanalysis.GTAnalysis.tscube`.</span>

<span class="sd">        roi : `~fermipy.roi_model.ROIModel`</span>
<span class="sd">            ROI Model object.  Generate markers at the positions of</span>
<span class="sd">            the sources in this ROI.</span>

<span class="sd">        zoom : float</span>
<span class="sd">            Crop the image by this factor.  If None then no crop is</span>
<span class="sd">            applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;catalogs&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catalogs&#39;</span><span class="p">])</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">workdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;workdir&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">])</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;suffix&#39;</span><span class="p">,</span> <span class="s1">&#39;tsmap&#39;</span><span class="p">)</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ts&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">sigma_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;sqrt_ts&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">sigma_levels</span><span class="p">,</span>
               <span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Sqrt(TS) [$\sigma$]&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_sqrt_ts&#39;</span> <span class="o">%</span> <span class="n">suffix</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;npred&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;NPred [Counts]&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
               <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_npred&#39;</span> <span class="o">%</span> <span class="n">suffix</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># make and draw histogram</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mf">25.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">25.0</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
                                   <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="c1"># ax.plot(bins,(1-chi2.cdf(x,dof))/2.,**kwargs)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">chi2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\chi^2_</span><span class="si">{1}</span><span class="s2"> / 2$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1E-4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># labels and such</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TS&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span>
                                          <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_ts_hist&#39;</span> <span class="o">%</span> <span class="n">suffix</span><span class="p">,</span>
                                          <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span>
                                          <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_roi_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_roi_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_roi_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gta</span><span class="p">,</span> <span class="n">mcube_tot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make various diagnostic plots for the 1D and 2D</span>
<span class="sd">        counts/model distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        prefix : str</span>
<span class="sd">            Prefix that will be appended to all filenames.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">loge_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loge_bounds&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">weighted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weighted&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">roi_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">roi_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;loge_bounds&#39;</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="p">)</span>
        <span class="n">roi_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
            <span class="s1">&#39;graticule_radii&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;graticule_radii&#39;</span><span class="p">])</span>
        <span class="n">roi_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;label_ts_threshold&#39;</span><span class="p">])</span>
        <span class="n">roi_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">roi_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;catalogs&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalogs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">loge_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loge_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">gta</span><span class="o">.</span><span class="n">log_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gta</span><span class="o">.</span><span class="n">log_energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">esuffix</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%.3f</span><span class="s1">_</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loge_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">mcube_diffuse</span> <span class="o">=</span> <span class="n">gta</span><span class="o">.</span><span class="n">model_counts_map</span><span class="p">(</span><span class="s1">&#39;diffuse&#39;</span><span class="p">)</span>
        <span class="n">counts_map</span> <span class="o">=</span> <span class="n">gta</span><span class="o">.</span><span class="n">counts_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
            <span class="n">wmap</span> <span class="o">=</span> <span class="n">gta</span><span class="o">.</span><span class="n">weight_map</span><span class="p">()</span>
            <span class="n">counts_map</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">counts_map</span><span class="p">)</span>
            <span class="n">mcube_tot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mcube_tot</span><span class="p">)</span>
            <span class="n">counts_map</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">wmap</span><span class="o">.</span><span class="n">data</span>
            <span class="n">mcube_tot</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">wmap</span><span class="o">.</span><span class="n">data</span>
            <span class="n">mcube_diffuse</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">wmap</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># colors = [&#39;k&#39;, &#39;b&#39;, &#39;g&#39;, &#39;r&#39;]</span>
        <span class="n">data_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">}</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gta</span><span class="o">.</span><span class="n">projtype</span> <span class="o">==</span> <span class="s2">&quot;WCS&quot;</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">gta</span><span class="o">.</span><span class="n">projtype</span> <span class="o">==</span> <span class="s2">&quot;HPX&quot;</span><span class="p">:</span>
            <span class="n">hpx2wcs</span> <span class="o">=</span> <span class="n">counts_map</span><span class="o">.</span><span class="n">make_wcs_mapping</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;CAR&#39;</span><span class="p">,</span> <span class="n">oversample</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">counts_map</span> <span class="o">=</span> <span class="n">counts_map</span><span class="o">.</span><span class="n">to_wcs</span><span class="p">(</span><span class="n">hpx2wcs</span><span class="o">=</span><span class="n">hpx2wcs</span><span class="p">)</span>
            <span class="n">mcube_tot</span> <span class="o">=</span> <span class="n">mcube_tot</span><span class="o">.</span><span class="n">to_wcs</span><span class="p">(</span><span class="n">hpx2wcs</span><span class="o">=</span><span class="n">hpx2wcs</span><span class="p">)</span>
            <span class="n">mcube_diffuse</span> <span class="o">=</span> <span class="n">mcube_diffuse</span><span class="o">.</span><span class="n">to_wcs</span><span class="p">(</span><span class="n">hpx2wcs</span><span class="o">=</span><span class="n">hpx2wcs</span><span class="p">)</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">mcube_tot</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">gta</span><span class="o">.</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">roi_kwargs</span><span class="p">)</span>
        <span class="n">rp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gta</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_model_map</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                     <span class="n">prefix</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">rp</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">counts_map</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">gta</span><span class="o">.</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">roi_kwargs</span><span class="p">)</span>

        <span class="n">rp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gta</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_counts_map</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                     <span class="n">prefix</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">iaxis</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">psuffix</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                          <span class="p">[</span><span class="s1">&#39;LON Offset [deg]&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT Offset [deg]&#39;</span><span class="p">],</span>
                                          <span class="p">[</span><span class="s1">&#39;xproj&#39;</span><span class="p">,</span> <span class="s1">&#39;yproj&#39;</span><span class="p">]):</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">rp</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                               <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="o">**</span><span class="n">data_style</span><span class="p">)</span>
            <span class="n">rp</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mcube_tot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                               <span class="n">noerror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">rp</span><span class="o">.</span><span class="n">plot_projection</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mcube_diffuse</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Diffuse&#39;</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                               <span class="n">noerror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">annotate</span><span class="p">(</span><span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gta</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_counts_map_</span><span class="si">%s%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">psuffix</span><span class="p">,</span>
                                                                <span class="n">esuffix</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_sed_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_sed_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_sed_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">sed</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">SEDPlotter</span><span class="p">(</span><span class="n">sed</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;sed&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">showlnl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;sedlnl&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_localization_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_localization_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_localization_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">skydir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skydir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="n">tsmap</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;tsmap&#39;</span><span class="p">]</span>
        <span class="n">fit_init</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit_init&#39;</span><span class="p">]</span>
        <span class="n">tsmap_renorm</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tsmap</span><span class="p">)</span>
        <span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">skydir</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;tsmap_peak&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">coordsys</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;tsmap_peak&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">coordsys</span>
        <span class="n">skydir</span> <span class="o">=</span> <span class="n">MapCoord</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">skydir</span><span class="p">,</span> <span class="n">coordsys</span><span class="o">=</span><span class="n">coordsys</span><span class="p">)</span><span class="o">.</span><span class="n">skycoord</span>

        <span class="n">path_effect</span> <span class="o">=</span> <span class="n">PathEffects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                             <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.21</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.99</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
               <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;2$</span><span class="se">\\</span><span class="s1">times\Delta\ln$L&#39;</span><span class="p">)</span>

        <span class="n">cdelt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsmap</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cdelt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsmap</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cdelt</span> <span class="o">=</span> <span class="p">[</span><span class="n">cdelt0</span><span class="p">,</span> <span class="n">cdelt1</span><span class="p">]</span>

        <span class="n">peak_skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">fit_init</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">],</span> <span class="n">fit_init</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span>
                               <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
        <span class="n">scan_skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span>
                               <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

        <span class="n">peak_pix</span> <span class="o">=</span> <span class="n">peak_skydir</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">scan_pix</span> <span class="o">=</span> <span class="n">scan_skydir</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ra_preloc&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">preloc_skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;ra_preloc&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;dec_preloc&#39;</span><span class="p">],</span>
                                     <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
            <span class="n">plot_markers</span><span class="p">(</span><span class="n">preloc_skydir</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">preloc_skydir</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">],</span>
                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Old Position&#39;</span><span class="p">)</span>

        <span class="n">plot_markers</span><span class="p">(</span><span class="n">peak_skydir</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">peak_skydir</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>

        <span class="n">plot_markers</span><span class="p">(</span><span class="n">scan_skydir</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">scan_skydir</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">],</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;New Position&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">skydir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pix</span> <span class="o">=</span> <span class="n">skydir</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xwidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">xmin</span>
            <span class="n">ywidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">ymin</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="n">xwidth</span><span class="p">,</span> <span class="n">ywidth</span><span class="p">,</span>
                          <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">fit_init</span><span class="p">,</span> <span class="n">peak_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r68&#39;</span><span class="p">)</span>
        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">fit_init</span><span class="p">,</span> <span class="n">peak_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r99&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scan_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r68&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;68% Uncertainty&#39;</span><span class="p">)</span>
        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scan_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r99&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;99% Uncertainty&#39;</span><span class="p">,</span>
                           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;68% Uncertainty&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;99% Uncertainty&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">])</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;localize&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">tsmap</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;tsmap_peak&#39;</span><span class="p">]</span>
        <span class="n">tsmap_renorm</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tsmap</span><span class="p">)</span>
        <span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.21</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.99</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
               <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="n">cb_label</span><span class="o">=</span><span class="s1">&#39;2$</span><span class="se">\\</span><span class="s1">times\Delta\ln$L&#39;</span><span class="p">)</span>

        <span class="n">cdelt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsmap</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cdelt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsmap</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cdelt</span> <span class="o">=</span> <span class="p">[</span><span class="n">cdelt0</span><span class="p">,</span> <span class="n">cdelt1</span><span class="p">]</span>
        <span class="n">scan_pix</span> <span class="o">=</span> <span class="n">scan_skydir</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">tsmap_renorm</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ra_preloc&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">preloc_skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;ra_preloc&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="s1">&#39;dec_preloc&#39;</span><span class="p">],</span>
                                     <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
            <span class="n">plot_markers</span><span class="p">(</span><span class="n">preloc_skydir</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">preloc_skydir</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">],</span>
                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Old Position&#39;</span><span class="p">)</span>

        <span class="n">plot_markers</span><span class="p">(</span><span class="n">scan_skydir</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">scan_skydir</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">],</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;New Position&#39;</span><span class="p">)</span>

        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scan_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r68&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;68% Uncertainty&#39;</span><span class="p">)</span>
        <span class="n">plot_error_ellipse</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scan_pix</span><span class="p">,</span> <span class="n">cdelt</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="s1">&#39;pos_r99&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;99% Uncertainty&#39;</span><span class="p">,</span>
                           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;68% Uncertainty&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;99% Uncertainty&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">])</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;localize_peak&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisPlotter.make_extension_plots"><a class="viewcode-back" href="../../fermipy.html#fermipy.plotting.AnalysisPlotter.make_extension_plots">[docs]</a>    <span class="k">def</span> <span class="nf">make_extension_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsmap&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_extension_tsmap</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ebin_ts_ext&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_extension_ebin</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_plot_extension_ebin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ts_ext&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">4.0</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">ectr</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_ctr&#39;</span><span class="p">]</span>
        <span class="n">delo</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_ctr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_min&#39;</span><span class="p">]</span>
        <span class="n">dehi</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_ctr&#39;</span><span class="p">]</span>
        <span class="n">xerr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">dehi</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
        <span class="n">xerr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delo</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">dehi</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">]))</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ectr</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr0</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_err_lo&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">],</span>
                          <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_err_hi&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">]),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ectr</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_ul95&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr1</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_ul95&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">m</span><span class="p">],</span> <span class="n">uplims</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy [log$_</span><span class="si">{10}</span><span class="s1">$(E/MeV)]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Extension [deg]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

        <span class="n">annotate_name</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>

        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_ul95&#39;</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_ul95&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_ul95&#39;</span><span class="p">])):</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_ul95&#39;</span><span class="p">]))</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_ext_ul95&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ts_ext&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ext_lo</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err_lo&#39;</span><span class="p">]</span>
            <span class="n">ext_hi</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err_hi&#39;</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_max&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="p">[</span><span class="n">ext_lo</span><span class="p">,</span> <span class="n">ext_lo</span><span class="p">],</span> <span class="p">[</span><span class="n">ext_hi</span><span class="p">,</span> <span class="n">ext_hi</span><span class="p">],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err_lo&#39;</span><span class="p">]))</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err_hi&#39;</span><span class="p">]))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_ul95&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ebin_e_max&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;extension_ebin&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_plot_extension_tsmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">ROIPlotter</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;tsmap&#39;</span><span class="p">],</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">sigma_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">sigma_levels</span><span class="p">,</span>
               <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

        <span class="n">path_effect</span> <span class="o">=</span> <span class="n">PathEffects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                             <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ts_ext&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">9.0</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">],</span> <span class="n">skydir</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;R$_</span><span class="si">{68}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err&#39;</span><span class="p">],</span> <span class="n">skydir</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;R$_</span><span class="si">{68}</span><span class="s1">$ $\pm 1 \sigma$&#39;</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_err&#39;</span><span class="p">],</span> <span class="n">skydir</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="s1">&#39;ext_ul95&#39;</span><span class="p">],</span> <span class="n">skydir</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;R$_</span><span class="si">{68}</span><span class="s1">$ 95% UL&#39;</span><span class="p">,</span>
                          <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">path_effect</span><span class="p">])</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_texts</span><span class="p">():</span>
            <span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">format_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;extension&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">],</span>
                                        <span class="n">extension</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_plot_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gta</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility function for generating diagnostic plots for the</span>
<span class="sd">        extension analysis.&quot;&quot;&quot;</span>

        <span class="c1"># format = kwargs.get(&#39;format&#39;, self.config[&#39;plotting&#39;][&#39;format&#39;])</span>

        <span class="k">if</span> <span class="n">loge_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loge_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="n">esuffix</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%.3f</span><span class="s1">_</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">loge_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loge_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">ExtensionPlotter</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                             <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">setup_projection_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">annotate</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_extension_xproj</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                     <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">setup_projection_axis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">annotate</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_extension_yproj</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                     <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">):</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%02i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">ExtensionPlotter</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                 <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">setup_projection_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
            <span class="n">annotate</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_extension_xproj</span><span class="si">%s%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                         <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">ROIPlotter</span><span class="o">.</span><span class="n">setup_projection_axis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
            <span class="n">annotate</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">loge_bounds</span><span class="o">=</span><span class="n">loge_bounds</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fileio&#39;</span><span class="p">][</span><span class="s1">&#39;workdir&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_extension_yproj</span><span class="si">%s%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                         <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">esuffix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Fermipy Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>