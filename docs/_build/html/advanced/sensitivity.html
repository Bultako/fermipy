

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sensitivity Tools &mdash; Fermipy 0.18.0+25.g938c.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Validation Tools" href="../validation/index.html" />
    <link rel="prev" title="Phased Analysis" href="phased.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Fermipy
          

          
          </a>

          
            
            
              <div class="version">
                0.18.0+25.g938c.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Output File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitting.html">ROI Optimization and Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model.html">Customizing the Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Analysis Methods</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sed.html">SED Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="lightcurve.html">Light Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="extension.html">Extension Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsmap.html">TS Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="tscube.html">TS Cube</a></li>
<li class="toctree-l2"><a class="reference internal" href="residmap.html">Residual Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="detection.html">Source Finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="localization.html">Source Localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="phased.html">Phased Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sensitivity Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../validation/index.html">Validation Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fermipy.html">fermipy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fermipy_jobs.html">fermipy.jobs subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fermipy_diffuse.html">fermipy.diffuse subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fermipy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Advanced Analysis Methods</a> &raquo;</li>
        
      <li>Sensitivity Tools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/advanced/sensitivity.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sensitivity-tools">
<span id="sensitivity"></span><h1>Sensitivity Tools<a class="headerlink" href="#sensitivity-tools" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">fermipy-flux-sensitivity</span></code> script calculates the LAT flux
threshold for a gamma-ray source in bins of energy (differential
sensitivity) and integrated over the full LAT energy range (integral
sensitivity).  The source flux threshold is the flux at which the
median TS of a source (twice the likelihood ratio of the best-fit model with and
without the source) equals a certain value.  Primary inputs to this script
are the livetime cube (output of <code class="docutils literal notranslate"><span class="pre">gtltcube</span></code>) and the model cube for the galactic diffuse
background.  The <code class="docutils literal notranslate"><span class="pre">obs_time_yr</span></code> option can be used to rescale the
livetime cube to a shorter or longer observation time.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fermipy-flux-sensitivity --glon<span class="o">=</span><span class="m">30</span> --glat<span class="o">=</span><span class="m">30</span> --output<span class="o">=</span>lat_sensitivity.fits <span class="se">\</span>
--ltcube<span class="o">=</span>ltcube.fits --galdiff<span class="o">=</span>gll_iem_v06.fits --event_class<span class="o">=</span>P8R2_SOURCE_V6 <span class="se">\</span>
--ts_thresh<span class="o">=</span><span class="m">25</span>.0 --min_counts<span class="o">=</span><span class="m">10</span>.0
</pre></div>
</div>
<p>If no livetime cube is provided then the sensitivity will be computed
assuming an “ideal” survey-mode operation with uniform exposure over
the whole sky and no Earth obscuration or deadtime.  By default the
flux sensitivity will be calculated for a TS threshold of 25 and at
least 3 counts.</p>
<p>A map of sensitivity with WCS or HEALPix pixelization can be generated
by setting the <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument to either <code class="docutils literal notranslate"><span class="pre">wcs</span></code> or <code class="docutils literal notranslate"><span class="pre">hpx</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a WCS sensitivity map of 50 x 50 deg centered at (glon,glat) = (30,30)</span>
$ fermipy-flux-sensitivity  --glon<span class="o">=</span><span class="m">30</span> --glat<span class="o">=</span><span class="m">30</span> --output<span class="o">=</span>lat_sensitivity_map.fits <span class="se">\</span>
--ltcube<span class="o">=</span>ltcube.fits --galdiff<span class="o">=</span>gll_iem_v06.fits --event_class<span class="o">=</span>P8R2_SOURCE_V6 <span class="se">\</span>
--map_type<span class="o">=</span>wcs --wcs_npix<span class="o">=</span><span class="m">100</span> --wcs_cdelt<span class="o">=</span><span class="m">0</span>.5 --wcs_proj<span class="o">=</span>AIT

<span class="c1"># Generate a HPX sensitivity map of nside=16</span>
$ fermipy-flux-sensitivity  --output<span class="o">=</span>lat_sensitivity_map.fits <span class="se">\</span>
--ltcube<span class="o">=</span>ltcube.fits --galdiff<span class="o">=</span>gll_iem_v06.fits --event_class<span class="o">=</span>P8R2_SOURCE_V6 <span class="se">\</span>
--map_type<span class="o">=</span>hpx --hpx_nside<span class="o">=</span><span class="m">16</span>
</pre></div>
</div>
<p>The integral and differential sensitivity maps will be written to the
<code class="docutils literal notranslate"><span class="pre">MAP_INT_FLUX</span></code> and <code class="docutils literal notranslate"><span class="pre">MAP_DIFF_FLUX</span></code> extensions respectively.</p>
<p>By default the flux sensitivity will be computed for a point-source
morphology.  The assumed source morphology can be changed with the
<code class="docutils literal notranslate"><span class="pre">spatial_model</span></code> and <code class="docutils literal notranslate"><span class="pre">spatial_size</span></code> parameters:</p>
<p>It is possible to choose among PowerLaw, LogParabola and
PLSuperExpCutoff SED shapes using the option <code class="docutils literal notranslate"><span class="pre">sedshape</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the sensitivity to a source with a 2D gaussian morphology</span>
<span class="c1"># and a 68% containment radius of 1 deg located at longitude 30deg and</span>
<span class="c1"># latitude 30 deg and with a PLSuperExpCutoff SED with index 2.0 and</span>
<span class="c1"># cutoff energy 10 GeV</span>
$ fermipy-flux-sensitivity --output<span class="o">=</span>lat_sensitivity_map.fits <span class="se">\</span>
--ltcube<span class="o">=</span>ltcube.fits --galdiff<span class="o">=</span>gll_iem_v06.fits --event_class<span class="o">=</span>P8R2_SOURCE_V6 <span class="se">\</span>
--spatial_model<span class="o">=</span>RadialGaussian --spatial_size<span class="o">=</span><span class="m">1</span>.0 --glon<span class="o">=</span><span class="m">30</span> --glat<span class="o">=</span><span class="m">30</span>
--sedshape<span class="o">=</span>PLSuperExpCutoff --index<span class="o">=</span><span class="m">2</span>.0 --cutoff<span class="o">=</span>1e4

<span class="c1"># Generate the sensitivity map in healpix with nside 128 of a point source with</span>
<span class="c1"># LogParabola SED and with spectral index 2.0 and curvature index beta=0.50</span>
<span class="c1"># between 1 and 10 GeV</span>
$ fermipy-flux-sensitivity --output<span class="o">=</span>lat_sensitivity_map.fits <span class="se">\</span>
--ltcube<span class="o">=</span>ltcube.fits --galdiff<span class="o">=</span>gll_iem_v06.fits --event_class<span class="o">=</span>P8R2_SOURCE_V6 <span class="se">\</span>
--spatial_model<span class="o">=</span>PointSource --sedshape<span class="o">=</span>LogParabola --index<span class="o">=</span><span class="m">2</span>.0 --beta<span class="o">=</span><span class="m">0</span>.50 <span class="se">\</span>
--hpx_nside<span class="o">=</span><span class="m">128</span> --map_type<span class="o">=</span>hpx --emin<span class="o">=</span><span class="m">1000</span> --emax<span class="o">=</span><span class="m">10000</span>
</pre></div>
</div>
<p>The output FITS file set with the <code class="docutils literal notranslate"><span class="pre">output</span></code> option contains the
following tables.  Note that <code class="docutils literal notranslate"><span class="pre">MAP</span></code> tables are only generated when
the <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument is set.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DIFF_FLUX</span></code> : Differential flux sensitivity for a gamma-ray source
at sky positition set by <code class="docutils literal notranslate"><span class="pre">glon</span></code> and <code class="docutils literal notranslate"><span class="pre">glat</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">INT_FLUX</span></code> : Integral flux sensitivity evaluated for PowerLaw
sources with spectral indices between 1.0 and 5.0 at sky positition
set by <code class="docutils literal notranslate"><span class="pre">glon</span></code> and <code class="docutils literal notranslate"><span class="pre">glat</span></code>.  Columns starting with <code class="docutils literal notranslate"><span class="pre">ebin</span></code> contain the source amplitude vs. energy bin.</li>
<li><code class="docutils literal notranslate"><span class="pre">MAP_DIFF_FLUX</span></code> : Sky cube with differential flux threshold
vs. sky position and energy.</li>
<li><code class="docutils literal notranslate"><span class="pre">MAP_DIFF_NPRED</span></code> : Sky cube with counts amplitude
(NPred) of a source at the detection threshold vs. position and energy.</li>
<li><code class="docutils literal notranslate"><span class="pre">MAP_INT_FLUX</span></code> : Sky map with integral flux threshold vs. sky
position.  Integral sensitivity will be computed for a PowerLaw
source with index equal to the <code class="docutils literal notranslate"><span class="pre">index</span></code> parameter.</li>
<li><code class="docutils literal notranslate"><span class="pre">MAP_INT_NPRED</span></code> : Sky map with counts amplitude (NPred)
of a source at the detection threshold vs. sky position.</li>
</ul>
<p>The output file can be read using the <a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v3.2.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Table</span></code></a> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;lat_sensitivity.fits&#39;</span><span class="p">,</span><span class="s1">&#39;DIFF_FLUX&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;e_min&#39;</span><span class="p">],</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;e_max&#39;</span><span class="p">],</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">])</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;lat_sensitivity.fits&#39;</span><span class="p">,</span><span class="s1">&#39;INT_FLUX&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../validation/index.html" class="btn btn-neutral float-right" title="Validation Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="phased.html" class="btn btn-neutral float-left" title="Phased Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Fermipy Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>